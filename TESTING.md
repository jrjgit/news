# 新闻播报系统测试计划

## 测试环境准备

### 1. 数据库配置
确保PostgreSQL数据库已配置并可访问：
```bash
# 设置环境变量
POSTGRES_URL=postgresql://user:password@localhost:5432/news
```

### 2. AI服务配置（可选）
如果要测试AI功能，配置以下环境变量之一：

**OpenAI:**
```env
AI_SERVICE_PROVIDER=openai
OPENAI_API_KEY=your-openai-api-key
OPENAI_MODEL=gpt-4
```

**DeepSeek:**
```env
AI_SERVICE_PROVIDER=deepseek
DEEPSEEK_API_KEY=your-deepseek-api-key
DEEPSEEK_MODEL=deepseek-chat
```

**本地模型 (Ollama):**
```env
AI_SERVICE_PROVIDER=local
LOCAL_MODEL_BASE_URL=http://localhost:11434
LOCAL_MODEL_MODEL=llama2
```

### 3. RSS源配置
确保配置了有效的RSS源：
```env
RSS_SOURCES_DOMESTIC=https://www.36kr.com/feed,https://www.cnbeta.com/backend.php,https://www.zhihu.com/rss
RSS_SOURCES_INTERNATIONAL=https://feeds.bbci.co.uk/news/world/rss.xml,https://feeds.npr.org/1001/rss.xml,https://www.theguardian.com/world/rss
```

### 4. 新闻数量配置
```env
NEWS_COUNT_DOMESTIC=15
NEWS_COUNT_INTERNATIONAL=10
```

---

## 功能测试清单

### Phase 1: 后端功能测试

#### 1.1 数据库迁移测试
```bash
# 测试数据库迁移
npx prisma migrate dev --name test_migration

# 验证新字段是否创建
npx prisma studio
```

**预期结果：**
- News表包含新字段：summary, translatedContent, originalLink, importance
- 迁移成功完成，无错误

#### 1.2 RSS解析器测试
```bash
# 测试RSS解析
npm run sync
```

**预期结果：**
- 成功从RSS源获取新闻
- 新闻去重功能正常工作
- 原始链接被保存
- 新闻数量符合配置（15+10）

**验证点：**
- 检查控制台输出，确认新闻数量
- 验证去重日志
- 检查数据库中的originalLink字段

#### 1.3 AI服务测试（如果配置了AI）

**测试AI摘要生成：**
```bash
# 查看同步日志，确认AI摘要生成
# 检查数据库中的summary字段
```

**预期结果：**
- 每条新闻都有AI生成的摘要
- 摘要长度在100-150字之间
- 摘要内容准确、简洁

**测试AI翻译：**
```bash
# 检查国际新闻的translatedContent字段
```

**预期结果：**
- 国际新闻有中文翻译
- 翻译内容准确、流畅

**测试重要性评估：**
```bash
# 检查importance字段
```

**预期结果：**
- 每条新闻都有重要性评分（1-5）
- 评分合理，重要新闻分数较高

#### 1.4 新闻生成器测试

**测试轻松播客风格：**
```bash
# 查看生成的播报脚本
# 检查script字段内容
```

**预期结果：**
- 播报脚本采用轻松风格
- 包含开场白、过渡语、结束语
- 语言自然、口语化

#### 1.5 API测试

**测试新闻列表API：**
```bash
# 测试基本查询
curl "http://localhost:3000/api/news"

# 测试日期筛选
curl "http://localhost:3000/api/news?date=2026-01-20"

# 测试分类筛选
curl "http://localhost:3000/api/news?category=DOMESTIC"

# 测试排序
curl "http://localhost:3000/api/news?sortBy=importance&order=desc"
```

**预期结果：**
- 返回正确的新闻列表
- 筛选和排序功能正常
- 包含所有新字段

**测试新闻详情API：**
```bash
curl "http://localhost:3000/api/news/1"
```

**预期结果：**
- 返回完整的新闻详情
- 包含所有字段（summary, translatedContent, originalLink, importance）

**测试同步API：**
```bash
curl -X POST "http://localhost:3000/api/sync"
```

**预期结果：**
- 同步任务成功执行
- 返回成功消息

---

### Phase 2: 前端功能测试

#### 2.1 主页面测试

**测试日期选择：**
1. 打开主页
2. 选择不同日期
3. 验证新闻列表更新

**预期结果：**
- 日期选择器正常工作
- 新闻列表根据日期更新
- 加载状态正确显示

**测试搜索功能：**
1. 在搜索框输入关键词
2. 验证搜索结果

**预期结果：**
- 搜索功能正常
- 结果准确匹配关键词
- 支持标题、内容、摘要搜索

**测试筛选功能：**
1. 测试分类筛选（全部/国内/国际）
2. 测试排序方式（重要性/创建时间/新闻日期）
3. 测试排序顺序（升序/降序）

**预期结果：**
- 所有筛选选项正常工作
- 排序结果正确
- 筛选器UI响应流畅

**测试收藏功能：**
1. 点击新闻卡片的收藏按钮
2. 验证收藏状态
3. 刷新页面，验证收藏持久化
4. 点击收藏按钮查看收藏列表

**预期结果：**
- 收藏功能正常工作
- 收藏状态持久化（localStorage）
- 收藏列表正确显示

**测试手动同步：**
1. 点击"手动同步"按钮
2. 验证同步状态
3. 等待同步完成

**预期结果：**
- 同步按钮状态正确
- 同步进度显示
- 同步完成后新闻更新

#### 2.2 新闻详情页测试

**测试详情页访问：**
1. 点击新闻标题或"查看详情"
2. 验证详情页加载

**预期结果：**
- 详情页正确加载
- 显示完整新闻信息

**测试AI摘要显示：**
1. 查看详情页的AI摘要区域

**预期结果：**
- AI摘要正确显示
- 摘要格式美观

**测试翻译内容显示：**
1. 查看国际新闻的中文翻译

**预期结果：**
- 翻译内容正确显示
- 与原文对照清晰

**测试原文链接：**
1. 点击"查看原文"链接

**预期结果：**
- 正确跳转到原文页面
- 在新标签页打开

**测试音频播放：**
1. 点击播放按钮
2. 测试播放/暂停
3. 测试进度条拖动

**预期结果：**
- 音频播放正常
- 控制功能正常

#### 2.3 组件测试

**测试NewsCard组件：**
1. 查看新闻卡片显示
2. 测试展开/收起功能
3. 测试重要性星级显示
4. 测试收藏按钮

**预期结果：**
- 卡片显示正确
- 所有交互功能正常

**测试AudioPlayer组件：**
1. 测试播放/暂停
2. 测试进度条
3. 测试时间显示

**预期结果：**
- 播放器功能完整
- UI响应流畅

**测试SearchBar组件：**
1. 输入搜索关键词
2. 测试清除按钮
3. 测试实时搜索（如果启用）

**预期结果：**
- 搜索功能正常
- UI交互流畅

**测试FilterPanel组件：**
1. 测试分类筛选
2. 测试排序选项
3. 测试移动端折叠/展开

**预期结果：**
- 所有筛选功能正常
- 响应式设计正确

---

### Phase 3: UI和体验测试

#### 3.1 视觉设计测试

**测试深色主题：**
- 验证整体配色方案
- 检查对比度是否合适
- 验证渐变效果

**预期结果：**
- 深色主题美观
- 对比度符合可访问性标准
- 渐变效果流畅

**测试动画效果：**
- 测试卡片悬停动画
- 测试按钮悬停效果
- 测试加载动画

**预期结果：**
- 动画流畅自然
- 不影响性能
- 过渡效果平滑

**测试玻璃态效果：**
- 验证背景模糊效果
- 检查边框效果

**预期结果：**
- 玻璃态效果美观
- 不影响内容可读性

#### 3.2 响应式测试

**测试桌面端（1920x1080）：**
- 验证布局正确
- 检查网格显示
- 测试所有功能

**预期结果：**
- 布局完美适配
- 所有功能正常

**测试平板端（768x1024）：**
- 验证布局调整
- 检查导航栏
- 测试触摸交互

**预期结果：**
- 布局正确调整
- 触摸交互流畅

**测试移动端（375x667）：**
- 验证单列布局
- 检查折叠菜单
- 测试所有功能

**预期结果：**
- 移动端体验良好
- 所有功能可用

#### 3.3 性能测试

**测试页面加载速度：**
- 测量首页加载时间
- 测量详情页加载时间

**预期结果：**
- 首页加载时间 < 3秒
- 详情页加载时间 < 2秒

**测试滚动性能：**
- 快速滚动新闻列表
- 验证滚动流畅度

**预期结果：**
- 滚动流畅无卡顿
- 帧率稳定

**测试内存使用：**
- 长时间使用应用
- 监控内存占用

**预期结果：**
- 内存占用稳定
- 无明显内存泄漏

---

### Phase 4: 集成测试

#### 4.1 端到端测试流程

**完整新闻同步流程：**
1. 清空数据库
2. 执行同步任务
3. 验证数据完整性
4. 测试前端显示

**预期结果：**
- 同步流程完整
- 数据正确保存
- 前端正确显示

**AI功能集成测试：**
1. 配置AI服务
2. 执行同步
3. 验证AI生成内容

**预期结果：**
- AI功能正常集成
- 生成内容质量良好

#### 4.2 错误处理测试

**测试网络错误：**
- 断开网络连接
- 尝试同步新闻
- 验证错误提示

**预期结果：**
- 错误提示清晰
- 应用不会崩溃

**测试API错误：**
- 模拟API失败
- 验证错误处理

**预期结果：**
- 错误处理正确
- 用户收到明确反馈

**测试数据异常：**
- 插入异常数据
- 验证应用行为

**预期结果：**
- 应用稳定运行
- 异常数据被正确处理

---

### Phase 5: 兼容性测试

#### 5.1 浏览器兼容性

**测试Chrome：**
- 最新版本
- 验证所有功能

**测试Firefox：**
- 最新版本
- 验证所有功能

**测试Safari：**
- 最新版本
- 验证所有功能

**测试Edge：**
- 最新版本
- 验证所有功能

#### 5.2 设备兼容性

**测试Windows：**
- Windows 10/11
- 验证所有功能

**测试macOS：**
- macOS 12+
- 验证所有功能

**测试Linux：**
- Ubuntu 20.04+
- 验证所有功能

---

## 测试报告模板

### 测试执行记录

| 测试项 | 测试结果 | 问题描述 | 严重程度 | 状态 |
|--------|----------|----------|----------|------|
| 数据库迁移 | ✅ 通过 | - | - | 完成 |
| RSS解析 | ✅ 通过 | - | - | 完成 |
| AI摘要生成 | ⏳ 待测试 | - | - | 待执行 |
| ... | ... | ... | ... | ... |

### Bug报告模板

**Bug标题：** [简短描述]

**严重程度：** [高/中/低]

**复现步骤：**
1. 步骤1
2. 步骤2
3. 步骤3

**预期结果：** [描述预期行为]

**实际结果：** [描述实际行为]

**环境信息：**
- 操作系统：
- 浏览器：
- 版本：

**截图/日志：** [附上截图或日志]

---

## 测试完成标准

### 功能完整性
- [ ] 所有核心功能正常工作
- [ ] 所有新增功能正常工作
- [ ] 所有API接口正常响应

### 性能标准
- [ ] 页面加载时间符合要求
- [ ] 滚动性能流畅
- [ ] 内存占用稳定

### 兼容性标准
- [ ] 主流浏览器兼容
- [ ] 主流操作系统兼容
- [ ] 移动端适配良好

### 用户体验标准
- [ ] UI美观一致
- [ ] 交互流畅自然
- [ ] 错误提示清晰

---

## 后续优化建议

1. **性能优化**
   - 实现虚拟滚动（大量新闻时）
   - 添加图片懒加载
   - 优化API响应时间

2. **功能增强**
   - 添加新闻分享功能
   - 实现新闻标签系统
   - 添加评论功能

3. **用户体验**
   - 添加骨架屏加载
   - 实现无限滚动
   - 添加离线支持

4. **监控和日志**
   - 添加错误追踪
   - 实现性能监控
   - 完善日志记录

---

## 测试工具推荐

1. **自动化测试**
   - Jest（单元测试）
   - Playwright（端到端测试）
   - Cypress（集成测试）

2. **性能测试**
   - Lighthouse（性能分析）
   - WebPageTest（加载性能）
   - Chrome DevTools（性能分析）

3. **兼容性测试**
   - BrowserStack（跨浏览器测试）
   - LambdaTest（云端测试）
   - Responsively App（响应式测试）

---

**测试负责人：** [姓名]
**测试日期：** [日期]
**版本：** [版本号]
**状态：** [进行中/已完成]