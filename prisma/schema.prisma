// 极简 Prisma Schema - Serverless First
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

// 核心：新闻数据
model News {
  id          String   @id @default(cuid())
  title       String
  summary     String
  content     String?  // 原文（可选）
  source      String
  category    Category
  importance  Int      @default(3) // 1-5
  date        String   // YYYY-MM-DD
  audioUrl    String?  // Blob URL（第一段，兼容旧数据）
  audioUrls   String?  // 所有音频URL，JSON数组格式
  originalUrl String?
  createdAt   DateTime @default(now())

  @@index([date])
  @@index([category])
  @@map("news")
}

// 同步任务（仅用于记录）
model SyncJob {
  id        String    @id @default(cuid())
  date      String    @unique // YYYY-MM-DD
  status    JobStatus @default(RUNNING)
  progress  Int       @default(0)
  message   String?   // 当前阶段消息
  newsCount Int       @default(0)
  error     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("sync_jobs")
}

enum Category {
  DOMESTIC
  INTERNATIONAL
}

enum JobStatus {
  RUNNING
  COMPLETED
  FAILED
}
